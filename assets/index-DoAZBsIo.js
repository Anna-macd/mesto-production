(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function o(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(n){if(n.ep)return;n.ep=!0;const c=o(n);fetch(n.href,c)}})();const s={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"4a7e57b5-298b-464b-acf4-190b4a54d573","Content-Type":"application/json"}},u=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),z=()=>fetch(`${s.baseUrl}/users/me`,{headers:s.headers}).then(u);function G(e,t){return fetch(`${s.baseUrl}/users/me`,{method:"PATCH",headers:s.headers,body:JSON.stringify({name:e,about:t})}).then(u)}function K(e){return fetch(`${s.baseUrl}/users/me/avatar`,{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:e})}).then(u)}function T(){return fetch(`${s.baseUrl}/cards`,{method:"GET",headers:s.headers}).then(u)}function Q(e,t){return fetch(`${s.baseUrl}/cards`,{method:"POST",headers:s.headers,body:JSON.stringify({name:e,link:t})}).then(u)}function ae(e){return fetch(`${s.baseUrl}/cards/${e}`,{method:"DELETE",headers:s.headers}).then(u)}function ue(e){return fetch(`${s.baseUrl}/cards/${e}/likes`,{method:"PUT",headers:s.headers}).then(u)}function de(e){return fetch(`${s.baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:s.headers}).then(u)}function pe(e,t){return fetch(`${s.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:s.headers}).then(u)}const X=Object.freeze(Object.defineProperty({__proto__:null,addLike:ue,addNewCard:Q,changeLikeCardStatus:pe,deleteCard:ae,getCardList:T,getUserInfo:z,removeLike:de,setUserInfo:G,updateUserAvatar:K},Symbol.toStringTag,{value:"Module"})),fe="modulepreload",_e=function(e,t){return new URL(e,t).href},W={},Y=function(t,o,r){let n=Promise.resolve();if(o&&o.length>0){let v=function(a){return Promise.all(a.map(f=>Promise.resolve(f).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};const i=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),U=l?.nonce||l?.getAttribute("nonce");n=v(o.map(a=>{if(a=_e(a,r),a in W)return;W[a]=!0;const f=a.endsWith(".css"),b=f?'[rel="stylesheet"]':"";if(r)for(let C=i.length-1;C>=0;C--){const g=i[C];if(g.href===a&&(!f||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${b}`))return;const d=document.createElement("link");if(d.rel=f?"stylesheet":fe,f||(d.as="script"),d.crossOrigin="",d.href=a,U&&d.setAttribute("nonce",U),document.head.appendChild(d),f)return new Promise((C,g)=>{d.addEventListener("load",C),d.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${a}`)))})}))}function c(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return n.then(i=>{for(const l of i||[])l.status==="rejected"&&c(l.reason);return t().catch(c)})},Z=(e,t)=>{const r=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0);r.querySelector(".card__image").src=e.link,r.querySelector(".card__image").alt=e.name,r.querySelector(".card__title").textContent=e.name;const n=r.querySelector(".card__control-button_type_delete"),c=r.querySelector(".card__like-button"),i=r.querySelector(".card__like-count"),l=r.querySelector(".card__control-button_type_info");return e.currentUserId!==e.owner._id&&(n.style.display="none"),e.likes.some(v=>v._id===e.currentUserId)&&c.classList.add("card__like-button_is-active"),i&&(i.textContent=e.likes.length),n.addEventListener("click",()=>{t.onOpenDeletePopup(e._id,r)}),c.addEventListener("click",()=>{const v=c.classList.contains("card__like-button_is-active");t.onLikeIcon(e._id,c,v)}),l.addEventListener("click",()=>{t.onInfoClick(e._id)}),r.querySelector(".card__image").addEventListener("click",()=>{t.onPreviewPicture(e)}),r},me=(e,t)=>Y(()=>Promise.resolve().then(()=>X),void 0,import.meta.url).then(o=>o.deleteCard(e).then(()=>(t.remove(),!0)).catch(r=>(console.error("Ошибка при удалении карточки:",r),!1))),ee=(e,t,o)=>{t.disabled=!0,Y(()=>Promise.resolve().then(()=>X),void 0,import.meta.url).then(r=>{r.changeLikeCardStatus(e,o).then(n=>{t.classList.toggle("card__like-button_is-active");const c=t.closest(".card__likes").querySelector(".card__like-count");c&&(c.textContent=n.likes.length)}).catch(n=>{console.error("Ошибка при изменении лайка:",n)}).finally(()=>{t.disabled=!1})})},te=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");m(t)}},h=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",te)},m=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",te)},ye=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{m(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&m(e)})};function j(e,t,o,r){const n=document.querySelector(`#${t.id}-error`);t.classList.add(r.inputErrorClass),n.textContent=o,n.classList.add(r.errorClass)}function oe(e,t,o){const r=document.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),r.classList.remove(o.errorClass),r.textContent=""}function he(e,t,o){t.validity.valid?oe(e,t,o):t.dataset.errorMessage&&t.validity.patternMismatch?j(e,t,t.dataset.errorMessage,o):j(e,t,t.validationMessage,o)}function Se(e){return e.some(t=>!t.validity.valid)}function re(e,t){e.disabled=!0,e.classList.add(t.inactiveButtonClass)}function ve(e,t){e.disabled=!1,e.classList.remove(t.inactiveButtonClass)}function R(e,t,o){Se(e)?re(t,o):ve(t,o)}function be(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);R(o,r,t),o.forEach(n=>{n.addEventListener("input",function(){he(e,n,t),R(o,r,t)})})}function Ce(e){Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{be(o,e)})}function L(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);o.forEach(n=>{oe(e,n,t)}),re(r,t)}const S={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};Ce(S);const w=document.querySelector(".places__list"),$=document.querySelector(".popup_type_edit"),q=$.querySelector(".popup__form"),ne=q.querySelector(".popup__input_type_name"),ce=q.querySelector(".popup__input_type_description"),B=document.querySelector(".popup_type_new-card"),p=B.querySelector(".popup__form"),Le=p.querySelector(".popup__input_type_card-name"),qe=p.querySelector(".popup__input_type_url"),M=document.querySelector(".popup_type_image"),H=M.querySelector(".popup__image"),ge=M.querySelector(".popup__caption"),ke=document.querySelector(".profile__edit-button"),Ee=document.querySelector(".profile__add-button"),O=document.querySelector(".profile__title"),A=document.querySelector(".profile__description"),N=document.querySelector(".profile__image"),F=document.querySelector(".popup_type_edit-avatar"),_=F.querySelector(".popup__form"),Pe=_.querySelector(".popup__input"),x=document.querySelector(".popup_type_info");x.querySelector(".popup__title");const V=x.querySelector(".popup__info"),J=x.querySelector(".popup__list"),D=document.querySelector(".popup_type_remove-card"),E=D.querySelector(".popup__button");let y={},P=null,I=null;const Ie=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),k=(e,t)=>{const r=document.querySelector("#popup-info-definition-template").content.querySelector(".popup__info-item").cloneNode(!0);return r.querySelector(".popup__info-term").textContent=e,r.querySelector(".popup__info-description").textContent=t,r},xe=e=>{const o=document.querySelector("#popup-info-user-preview-template").content.querySelector(".popup__list-item").cloneNode(!0);return o.querySelector(".popup__info-user-name").textContent=e.name,o.querySelector(".popup__info-user-avatar").style.backgroundImage=`url('${e.avatar}')`,o},se=e=>{T().then(t=>{const o=t.find(r=>r._id===e);o&&(V.innerHTML="",J.innerHTML="",V.append(k("Описание:",o.name),k("Дата создания:",Ie(new Date(o.createdAt))),k("Автор:",o.owner.name),k("Количество лайков:",o.likes.length.toString())),o.likes.length>0&&o.likes.forEach(r=>{J.append(xe(r))}),h(x))}).catch(t=>{console.log(t)})},ie=({name:e,link:t})=>{H.src=t,H.alt=e,ge.textContent=e,h(M)},le=(e,t)=>{P=e,I=t,h(D)},Ue=()=>{if(!P||!I)return;const e=E.textContent;E.textContent="Удаление...",me(P,I).then(t=>{t&&m(D)}).catch(t=>{console.error("Ошибка при удалении карточки:",t)}).finally(()=>{E.textContent=e,P=null,I=null})},we=e=>{e.preventDefault();const t=q.querySelector(".popup__button"),o=t.textContent;t.textContent="Сохранение...",G(ne.value,ce.value).then(r=>{O.textContent=r.name,A.textContent=r.about,m($)}).catch(r=>{console.log(r)}).finally(()=>{t.textContent=o})},Te=e=>{e.preventDefault();const t=_.querySelector(".popup__button"),o=t.textContent;t.textContent="Сохранение...",K(Pe.value).then(r=>{N.style.backgroundImage=`url('${r.avatar}')`,_.reset(),L(_,S),m(F)}).catch(r=>{console.log(r)}).finally(()=>{t.textContent=o})},$e=e=>{e.preventDefault();const t=p.querySelector(".popup__button"),o=t.textContent;t.textContent="Создание...",Q(Le.value,qe.value).then(r=>{r.currentUserId=y._id,w.prepend(Z(r,{onPreviewPicture:ie,onLikeIcon:ee,onOpenDeletePopup:le,onInfoClick:se})),p.reset(),L(p,S),m(B)}).catch(r=>{console.log(r)}).finally(()=>{t.textContent=o})};q.addEventListener("submit",we);p.addEventListener("submit",$e);_.addEventListener("submit",Te);E.addEventListener("click",Ue);ke.addEventListener("click",()=>{ne.value=O.textContent,ce.value=A.textContent,L(q,S),h($)});N.addEventListener("click",()=>{_.reset(),L(_,S),h(F)});Ee.addEventListener("click",()=>{p.reset(),L(p,S),h(B)});Promise.all([T(),z()]).then(([e,t])=>{y=t,O.textContent=y.name,A.textContent=y.about,N.style.backgroundImage=`url('${y.avatar}')`,w.innerHTML="",e.forEach(o=>{o.currentUserId=y._id,w.append(Z(o,{onPreviewPicture:ie,onLikeIcon:ee,onOpenDeletePopup:le,onInfoClick:se}))})}).catch(e=>{console.log(e)});const Be=document.querySelectorAll(".popup");Be.forEach(e=>{ye(e)});
